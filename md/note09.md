# JWT 기반 로그인/로그아웃

## 토큰 기반 인증
- 사용자가 서버에 접근할 때 사용자가 인증된 사용자인지 확인하는 방법은 다양하다. (서버 기반, 토큰 기반)
- Ch8 '[스프링 시큐리티 로그인/로그아웃, 회원가입 구현하기](/md/note08.md)'
  - 세션 기반 인증 사용 : 사용자마다 사용자의 정보를 담은 세션을 생성하고 저장해서 인증한다
-  토큰은 서버에서 클라이언트를 구분하기 위한 유일한 값   
  - 서버가 토큰을 생성해서 클라이언트에게 제공 &rarr;  클라이언트는 이 토큰을 갖고 있다가 여러 요청을 해당 토큰과 함께 신청 &rarr; 서버는 토큰을 보고 유효한 사용자인지 검증

### 토큰을 전달하고 인증받는 과정
![token_req_auth](/md/upload/img_token_req_auth.png)
1. 클라이언트: 아이디와 비밀번호를 서버에게 전달하면서 인증 요청(request)
2. 서버: 아이디와 비밀번호 확인해 유효한 사용자인지 검증, 유효하면 토큰 생성하여 응답(response)
3. 클라이언트: 서버에서 전달한 토큰을 저장
4. 클라이언트: 인증이 필요한 API를 사용할 때 토큰을 함께 전송
5. 서버: 전송된 토큰이 유효한지 검증
6. 유효한 토큰이면 클라이언트의 요청 내용을 처리함

### 토큰 기반 인증의 특징
#### 무상태성 stateless
- 사용자의 인증 정보가 담겨있는 토큰이, 서버가 아닌 클라이언트에 있으므로 서버에 저장할 필요가 없다
- 클라이언트에서는 사용자의 인증 상태를 유지하면서 이후 요청을 처리한다 &rarr; 상태를 관리한다
- 서버 입장에서는 클라이언트의 인증 정보를 저장하거나 유지하지 않아도 되기 때문에 완전한 무상태(stateless)로 효율적인 검증 가능
#### 확장성
- 무상태성은 확장성에 영향을 준다 : 서버를 확장할 때 상태관리를 신경 쓸 필요가 없어 서버 확장에도 용이하다
- 토큰을 가지는 주체는 클라이언트이기 때문에 가지고 있는 하나의 토큰으로 여러 서버에 요청을 보낼 수 있다
#### 무결성
- HMAC(hash-based message authentication) 기법
- 토큰을 발급한 이후에는 토큰 정보를 변경하는 행위를 할 수 없다 &rarr; 토큰의 무결성 보장
- 누군가 토큰을 한 글자라도 변경하면 유효하지 않은 토큰이라고 판단함

## JWT
발급받은 JWT를 이용해 인증하려면 HTTP 요청 헤더 중에 Authorization 키값에 Bearer + JWT 토큰값을 넣어 보내야 함   
![token_jwt](/md/upload/img_token_req_auth.png)

> aaaaa (헤더) . bbbbb (내용) . ccccc (서명)

**헤더** : 토큰의 타입과 해싱 알고리즘을 지정하는 정보를 담는다   
**내용** : 토큰과 관련된 정보를 담는다  
클레임 : 내용의 한 덩어리, 키값의 한 쌍으로 이루어짐

| 이름  | 설명                                                                                        |
|:----|:------------------------------------------------------------------------------------------|
| lss | 토큰 발급자(issuer)                                                                            |
| sub | 토큰 제목(subject)                                                                            |
| aud | 토큰 대상자(audience)                                                                          |
| exp | 토큰 만료시간(expiration)<br/>시간은 NumericDate 형식으로하며, 항상 현재 시간 이후로 설정                           |
| nbf | 토큰의 활설 날짜와 비슷한 개념 (Not Before)<br/>NumericDate 형식으로 날짜를 지정하며, 이 날짜가 지나기 전까지는 토큰이 처리되지 않는다 |
| iat | 토큰이 발급된 시간 (issued at)                                                                    |
| jti | JWT의 고유 식별자, 주로 일회용 토큰에 사용한다                                                              |